{% extends "base.html" %}

{% block content %}
    <h1>üé¨ Top Recommendations by Genre</h1>
    <p style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-bottom: 30px;">
        Select a genre to see the top-rated movies (capped at 10) that belong to that genre, 
        based on predictions from our ML model.
    </p>

    <div class="card">
        <form action="/by_genre" method="POST" id="genreForm">
            <div style="margin-bottom: 15px;">
                <label for="genre" style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">
                    Select a Genre:
                </label>
                <select 
                    name="genre" 
                    id="genre" 
                    style="width: 100%; padding: 12px 15px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; outline: none; transition: border-color 0.3s ease;"
                    required
                >
                    <option value="">-- Choose a genre --</option>
                    {% for genre in available_genres %}
                        <option value="{{ genre }}" {% if selected_genre == genre %}selected{% endif %}>
                            {{ genre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn">
                üé¨ Get Top 10 Recommendations
            </button>
        </form>
    </div>

    {% if selected_genre %}
        {% if recommendations %}
            <div style="margin-top: 30px;">
                <h2 style="color: white; margin-bottom: 20px;">
                    Top 10 Movies in: <span style="color: #ffd700;">{{ selected_genre }}</span>
                </h2>
                <div style="display: grid; gap: 15px;">
                    {% for movie in recommendations %}
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 300px;">
                                    <h3 style="margin-top: 0;">
                                        <span style="color: #667eea; font-size: 1.2em;">#{{ loop.index }}</span>
                                        {{ movie.title }}
                                    </h3>
                                    <p style="margin: 10px 0;">
                                        <span class="rating-badge">
                                            ‚≠ê {{ "%.2f"|format(movie.predicted_rating) }} / 5.0
                                        </span>
                                    </p>
                                    {% if movie.genres %}
                                    <div style="margin: 15px 0;">
                                        <strong style="color: #495057;">Genres:</strong>
                                        <div style="margin-top: 8px;">
                                            {% for genre in movie.genres.split('|') %}
                                                <span class="genre-tag" {% if genre == selected_genre %}style="background-color: #667eea; color: white;"{% endif %}>
                                                    {{ genre }}
                                                </span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                <div style="margin-top: 15px;">
                                    <form action="/similar" method="POST" style="display:inline;">
                                        <input type="hidden" name="movie_search" value="{{ movie.title }}">
                                        <button type="submit" class="btn btn-secondary">Find Similar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="card empty-state" style="margin-top: 30px;">
                <h3>‚ö†Ô∏è No Movies Found</h3>
                <p>We couldn't find any movies in the genre "{{ selected_genre }}" among the top recommendations. 
                   This might be because there are no highly-rated movies in this genre, or the genre name doesn't match exactly.</p>
            </div>
        {% endif %}
    {% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Auto-submit form when genre selection changes (optional enhancement)
    document.addEventListener("DOMContentLoaded", function() {
        const genreSelect = document.getElementById("genre");
        if (genreSelect) {
            // Uncomment the line below if you want auto-submit on selection change
            genreSelect.addEventListener("change", function() { document.getElementById("genreForm").submit(); });
        }
    });
</script>
{% endblock %}
